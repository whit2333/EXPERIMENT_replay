#!/bin/bash

REMOVE_LINKS=
package=make_symbolic_links

while test $# -gt 0; do
  case "$1" in
    -h|--help)
      echo "$package - emulate hallc_replay directory with symbolic links "
      echo "  Usage:"
      echo "     $package [options] "
      echo "      "
      echo "  options:"
      echo "     -h, --help                show brief help"
      echo "     -r, --remove              remove symlinks"
      #echo "-o, --output-dir=DIR      specify a directory to store output in"
      exit 0
      ;;
    -r|--remove)
      REMOVE_LINKS=1
      shift
      #if test $# -gt 0; then
      #  export REMOVE_LINKS=$1
      #else
      #  echo "no process specified"
      #  exit 1
      #fi
      #shift
      ;;
    #--action*)
    #  export PROCESS=`echo $1 | sed -e 's/^[^=]*=//g'`
    #  shift
    #  ;;
    #-o)
    #  shift
    #  if test $# -gt 0; then
    #    export OUTPUT=$1
    #  else
    #    echo "no output dir specified"
    #    exit 1
    #  fi
    #  shift
    #  ;;
    #--output-dir*)
    #  export OUTPUT=`echo $1 | sed -e 's/^[^=]*=//g'`
    #  shift
    #  ;;
    *)
      break
      ;;
  esac
done


function dolinks {
  adir=$1
  my_link=$2
  if [ -L ${adir} ] ; then
    if [ -e ${adir} ] ; then
      #echo "Good link"
      if [ -n "${REMOVE_LINKS}" ] ; then
        echo "removing link ${adir} --> ${my_link}"
        rm ${adir}
      fi
    else
      if [ -n "${REMOVE_LINKS}" ] ; then
        echo "removing link ${adir} --> ${my_link}"
        rm ${adir}
      else 
        echo "Fixing broken link ${adir} --> ${my_link}"
        ln -s ${my_link} ${adir}
      fi
    fi
  elif [ -e ${adir} ] ; then
    echo "Not a link"
  else
    if [ -z ${REMOVE_LINKS} ] ; then
      echo "Adding link ${adir} --> ${my_link}"
      ln -s ${my_link} ${adir}
    fi
  fi
}

for adir in CALIBRATION
do
  my_link=hallc_CALIBRATION/${adir}
  dolinks ${adir} ${my_link}
done

for adir in  DBASE DEF-files MAPS PARAM TEMPLATES SCRIPTS onlineGUI
do
  my_link=hallc_replay/${adir}
  dolinks ${adir} ${my_link}
done
#  #echo ${adir}
#  if [ -L ${adir} ] ; then
#    if [ -e ${adir} ] ; then
#      #echo "Good link"
#      if [ -n ${REMOVE_LINKS} ] ; then
#        echo "removing link ${adir} --> ${my_link}"
#        rm ${adir}
#      fi
#    else
#      if [ -n ${REMOVE_LINKS} ] ; then
#        echo "removing link ${adir} --> ${my_link}"
#        rm ${adir}
#      else 
#        echo "Fixing broken link ${adir} --> ${my_link}"
#        ln -s ${my_link} ${adir}
#      fi
#    fi
#  elif [ -e ${adir} ] ; then
#    echo "Not a link"
#  else
#    if [ -z ${REMOVE_LINKS} ] ; then
#      echo "Adding link ${adir} --> ${my_link}"
#      ln -s ${my_link} ${adir}
#    fi
#  fi
#done

#for adir in  DBASE DEF-files MAPS PARAM TEMPLATES SCRIPTS onlineGUI
#do
#  my_link=hallc_replay/${adir}
#  #echo ${adir}
#  if [ -L ${adir} ] ; then
#    if [ -e ${adir} ] ; then
#      echo "Good link"
#      rm ${adir}
#    else
#      echo "Fixing broken link ${adir} --> ${my_link}"
#      rm ${adir}
#      ln -s ${my_link} ${adir}
#    fi
#  elif [ -e ${adir} ] ; then
#    echo "Not a link"
#  else
#    echo "Adding linke ${adir} --> ${my_link}"
#    ln -s ${my_link} ${adir}
#  fi
#done
##raw -> /home/whit/globus_files/hallc/raw/
##rootfiles -> /home/whit/globus_files/hallc/rootfiles/


